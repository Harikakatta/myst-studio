## Configure Jenkins Build Job

In this section we cover how to configure an an automated build job in Jenkins, this will perform the following steps:
* Periodically poll our source code repository for new code commits.
* On detection of a new code commit, initiate Maven to build and package the code.
* Publish the packaged code (or artifact) to a Software Repository, such as Artifactory, Nexus or Archiva.
* Register the artifact with MyST.


### Setup global variables in Jenkins
To simplify on-going configuration of jobs in Jenkins, we recommend defining a couple of global properties. Log into the Jenkins console, click on `Manage Jenkins` and select `Configure System`.

Locate the `Global properties` section and click on the `Environment variables` checkbox if not already selected. Then click `Add` to add the following variables. 

* **MAVEN_REPO_URL** -  This is the URL of the Software Repository (such as Artifactory, Nexus or Archiva) that we will publish our built artifacts to.
* **FMW_HOME** = The location of the Oracle Fusion Middleware Oracle Home where the Oracle Middleware is installed.

![](img/jenkinsConfigureGlobalProperties.PNG)

Click `Save`. We will re-use these variables later in our automated jobs.

### Create OSB Automated Build Job
From with the Jenkins console, click on `New Item`. Enter the Item Name and select `Maven project`.

![](img/jenkinsNewItem.PNG)

Click `OK`.

Under `Source Code Management` select your source code repository type (such as  Subversion or Git). Enter the URL of the source code repository and 

as svn://mattwright-myst.testdrive.fusioncloud.com/repos/code/trunk/12.2.1/Stock/src/osb. 

You can leave all the other defaults.

Under `Build Triggers` tick `Poll SCM` and enter the schedule, for example a schedule of `H/10 * * * *` means to poll every ten minute.


#### Add Pre-Build Step
Click on `Add pre-build step` and then select `Invoke top-level Maven targets`

Select Maven as the Maven Version and enter the following into the Goals field:

```
build-helper:parse-version versions:set '-DnewVersion=${parsedVersion.majorVersion}.${parsedVersion.minorVersion}-${BUILD_NUMBER}'
``` 
This tells Maven to always append the build number to the artifact version.

#### Add Build Details
Go to the `Build` section. For the `Root POM` enter 

  and enter Stock/pom.xml for the Root POM and 
  
For the Goals and options field enter `clean package -DoracleHome=$FMW_HOME`.

Click `Save`. 

### Execute Build Job
This will take you back to the main job screen.
After a short time, you should see that the build has been automatically kicked off. 
Click on progress bar to see the Console Output.

> The first time Jenkins executes a build job for a particular component type, Maven has to  downloaded all of the build dependencies, as a result the initial execution can take a while, future builds should be significantly faster.

### Update Build Job to publish to Artifactory
Click on the com.acme-StockServices job.
Then click on Configure
Navigate to Build and add the following to the end of the Goals and options 
```
install:install deploy:deploy - DaltDeploymentRepository=central::default::$MAVEN_REPO_URL
```

Click Save
Click on Build now
You should now see Build #2 running in the Build History. Click on the progress bar to see the Console Output.

### Update Build job to register artifact with MyST Studio
From the Jenkins console click on the com.acme-StockServices job.
Click on Configure
Navigate to the bottom of the page where it shows Post-build Actions
Click on Add post-build action and then select Publish to MyST Studio 

Make sure the Active box is ticked.

Click on Build Now
Click on the progress bar for the job that appears in the Build History to go to the Console Output.
At the end of the output you should see an output similar to the following
```
{
  "buildNumber": "3",
  "startTime": "2016.06.09 at 04:24:45 UTC",
  "endTime": "2016.06.09 at 04:25:32 UTC",
  "status": "SUCCESS",
  "component": {
    "componentType": "ofmw-osb",
    "description": "",
    "mavenModel": {
      "groupId": "com.acme",
      "artifactId": "StockServices"
    },
    "binaryVersion": "1.0-3",
    "managedBy": "CI_SERVER",
    "buildStatus": "BUILT",
    "metadata": {
      "artifact.repository.type": "sbar"
    },
    "name": "StockServices",
    "topLevel": true
  },
  "scmState": {
    "url": "svn://mattwright-myst.testdrive.fusioncloud.com/repos/code/trunk/12.2.1/Stock/src/osb",
    "branch": "NA",
    "commit": "3"
  }
}
```
Your OSB artifact has now been published to MyST Studio.

Observe the registered artifacts in Studio